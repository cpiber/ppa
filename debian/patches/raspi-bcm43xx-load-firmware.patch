Author: Simon Long <simon@raspberrypi.org>
Forwarded: https://patchwork.kernel.org/project/bluetooth/patch/20201218190609.107898-4-dave.jones@canonical.com/
Last-Update: 2020-12-18
Description: Patches for loading the bcm43xx firmware
 This patch corrects the location of the firmware from /etc/firmware to
 /lib/firmware, and disables setting the UART interface speed *before* loading
 the firmware (a later call sets the speed of the interface as requested). It
 also introduces a short wait after the firmware load before the module is
 reset.

Index: ppa/tools/hciattach_bcm43xx.c
===================================================================
--- ppa.orig/tools/hciattach_bcm43xx.c
+++ ppa/tools/hciattach_bcm43xx.c
@@ -352,9 +352,6 @@ int bcm43xx_init(int fd, int def_speed,
 	if (bcm43xx_locate_patch(FIRMWARE_DIR, chip_name, fw_path)) {
 		fprintf(stderr, "Patch not found, continue anyway\n");
 	} else {
-		if (bcm43xx_set_speed(fd, ti, speed))
-			return -1;
-
 		if (bcm43xx_load_firmware(fd, fw_path))
 			return -1;
 
Index: ppa/tools/hciattach.h
===================================================================
--- ppa.orig/tools/hciattach.h
+++ ppa/tools/hciattach.h
@@ -41,7 +41,7 @@
 #define HCI_UART_VND_DETECT	5
 
 #ifndef FIRMWARE_DIR
-#define FIRMWARE_DIR "/etc/firmware"
+#define FIRMWARE_DIR "/lib/firmware"
 #endif
 
 int read_hci_event(int fd, unsigned char *buf, int size);
